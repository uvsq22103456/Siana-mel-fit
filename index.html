<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>GLOW UP - Siana & Mel</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #f9a8d4; /* Pink 300 */
            --primary-dark: #db2777; /* Pink 600 */
            --bg-app: #fff1f2; /* Rose 50 */
            --surface: #ffffff;
            --shadow: 0 10px 30px -10px rgba(244, 63, 94, 0.15);
        }

        body.theme-mel {
            --primary: #c4b5fd; /* Violet 300 */
            --primary-dark: #7c3aed; /* Violet 600 */
            --bg-app: #f5f3ff; /* Violet 50 */
        }

        body { 
            font-family: 'Quicksand', sans-serif; 
            background-color: var(--bg-app); 
            color: #4a044e; /* Text Dark */
            height: 100dvh; 
            display: flex; 
            flex-direction: column; 
            transition: background-color 0.5s ease;
        }

        .safe-area { padding-top: max(env(safe-area-inset-top), 20px); }
        
        .card {
            background: var(--surface);
            border-radius: 24px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255,255,255,0.6);
        }

        .week-scroll {
            display: flex;
            overflow-x: auto;
            gap: 12px;
            padding: 10px 20px;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }
        .week-scroll::-webkit-scrollbar { display: none; }

        .day-pill {
            min-width: 60px;
            height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            background: rgba(255,255,255,0.6);
            border: 2px solid transparent;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            color: #831843;
        }
        
        .day-active {
            background: var(--surface);
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 8px 20px -5px var(--primary);
        }

        .btn-action {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 4px 15px var(--primary);
        }

        /* Animations */
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .anim-item { animation: slideIn 0.4s ease-out forwards; }
        
        input, select {
            background: #fdf2f8;
            border: 1px solid #fbcfe8;
            color: #831843;
            border-radius: 12px;
            outline: none;
            transition: all 0.2s;
        }
        input:focus, select:focus { border-color: var(--primary-dark); background: white; }

        .glass-header {
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255,255,255,0.5);
        }
    </style>
</head>
<body class="theme-siana">

    <header class="glass-header sticky top-0 z-50 safe-area pb-2">
        <div class="px-5 flex justify-between items-center mb-2">
            <h1 class="text-xl font-bold tracking-tight text-pink-900">GLOW UP ‚ú®</h1>
            <div class="flex bg-white rounded-full p-1 shadow-sm border border-pink-100">
                <button onclick="switchUser('siana')" id="btn-siana" class="px-3 py-1.5 rounded-full text-xs font-bold transition-all bg-pink-400 text-white shadow-md">üå∏ Siana</button>
                <button onclick="switchUser('mel')" id="btn-mel" class="px-3 py-1.5 rounded-full text-xs font-bold transition-all text-gray-400">ü¶ã Mel</button>
            </div>
        </div>
        
        <div class="flex items-center justify-between px-6 mb-2">
            <button onclick="changeWeek(-1)" class="p-2 opacity-50 hover:opacity-100">‚ùÆ</button>
            <div class="text-center">
                <div class="text-[10px] uppercase font-bold tracking-widest opacity-50">Semaine du</div>
                <div id="week-display" class="text-sm font-bold text-pink-900">...</div>
            </div>
            <button onclick="changeWeek(1)" class="p-2 opacity-50 hover:opacity-100">‚ùØ</button>
        </div>

        <div id="days-container" class="week-scroll">
            </div>
    </header>

    <main class="flex-1 overflow-y-auto p-5 pb-32 space-y-6">

        <div class="flex justify-between items-center anim-item">
            <div>
                <h2 id="current-day-title" class="text-2xl font-bold text-pink-950">Lundi</h2>
                <p class="text-xs font-semibold opacity-50" id="current-full-date">12 F√©vrier</p>
            </div>
            <button onclick="copyLastWeek()" class="bg-white border border-pink-200 text-pink-600 px-4 py-2 rounded-xl text-[10px] font-bold uppercase shadow-sm active:scale-95 transition flex items-center gap-2">
                <span>üîÑ</span> Copier J-7
            </button>
        </div>

        <div id="workout-list" class="space-y-4">
            <div class="text-center py-10 opacity-40">
                <div class="text-4xl mb-2">üßò‚Äç‚ôÄÔ∏è</div>
                <p class="text-sm font-bold">Rien de pr√©vu pour le moment.</p>
                <p class="text-xs">Ajoute un exercice ou copie la semaine derni√®re !</p>
            </div>
        </div>

        <div class="flex justify-center anim-item">
            <button onclick="openModal()" class="btn-action w-12 h-12 rounded-full flex items-center justify-center text-2xl shadow-lg transition active:scale-90">
                Ôºã
            </button>
        </div>

    </main>

    <div id="modal" class="fixed inset-0 bg-pink-900/20 backdrop-blur-sm z-[60] hidden flex items-end sm:items-center justify-center">
        <div class="bg-white w-full sm:max-w-md rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl anim-item">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold text-lg text-pink-900">Nouvel Exercice üí™</h3>
                <button onclick="closeModal()" class="text-gray-400 text-xl">‚úï</button>
            </div>
            
            <div class="space-y-4">
                <input type="text" id="ex-name" placeholder="Nom de l'exo (ex: Hip Thrust)" class="w-full p-4 font-bold text-lg">
                
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="text-[10px] uppercase font-bold text-gray-400 pl-2">S√©ries</label>
                        <input type="number" id="ex-sets" placeholder="4" class="w-full p-3 font-bold text-center">
                    </div>
                    <div>
                        <label class="text-[10px] uppercase font-bold text-gray-400 pl-2">Reps</label>
                        <input type="number" id="ex-reps" placeholder="12" class="w-full p-3 font-bold text-center">
                    </div>
                </div>

                <div>
                    <label class="text-[10px] uppercase font-bold text-gray-400 pl-2 mb-1 block">Type de charge</label>
                    <div class="grid grid-cols-3 gap-2 mb-3">
                        <button type="button" onclick="setType('normal')" id="btn-t-normal" class="py-2 rounded-xl text-[10px] font-bold border border-pink-200 bg-pink-50 text-pink-600">Normal</button>
                        <button type="button" onclick="setType('progressive')" id="btn-t-progressive" class="py-2 rounded-xl text-[10px] font-bold border border-gray-100 text-gray-400">Progressif üìà</button>
                        <button type="button" onclick="setType('degressive')" id="btn-t-degressive" class="py-2 rounded-xl text-[10px] font-bold border border-gray-100 text-gray-400">D√©gressif üìâ</button>
                    </div>

                    <div id="weight-single" class="relative">
                        <input type="number" id="ex-w1" placeholder="Poids (kg)" class="w-full p-3 font-bold text-center text-pink-600">
                        <span class="absolute right-4 top-3 text-xs font-black text-pink-200">KG</span>
                    </div>

                    <div id="weight-double" class="hidden grid grid-cols-2 gap-3 items-center">
                        <div class="relative">
                            <input type="number" id="ex-w-start" placeholder="D√©but" class="w-full p-3 font-bold text-center text-pink-600">
                            <span class="absolute right-2 top-3 text-[9px] font-black text-pink-200">KG</span>
                        </div>
                        <div class="text-center text-gray-300 font-bold">‚ûî</div>
                        <div class="relative">
                            <input type="number" id="ex-w-end" placeholder="Fin" class="w-full p-3 font-bold text-center text-pink-600">
                            <span class="absolute right-2 top-3 text-[9px] font-black text-pink-200">KG</span>
                        </div>
                    </div>
                    <div id="hint-text" class="text-[10px] text-center text-gray-400 mt-1 h-4">Charge constante</div>
                </div>

                <button onclick="saveExercise()" class="w-full btn-action py-4 rounded-xl font-bold uppercase text-sm mt-4">Ajouter</button>
            </div>
        </div>
    </div>

    <script>
        // CONFIG
        let currentUser = localStorage.getItem('glow_user') || 'siana';
        let currentType = 'normal'; // normal, progressive, degressive
        
        // DATE LOGIC
        let viewDate = new Date(); // The date we are currently focusing on in the logic
        let selectedDateStr = new Date().toISOString().split('T')[0]; // YYYY-MM-DD

        // DATABASE
        let db = JSON.parse(localStorage.getItem('glow_db_v1')) || {
            siana: {},
            mel: {}
        };

        function saveDB() {
            localStorage.setItem('glow_db_v1', JSON.stringify(db));
            localStorage.setItem('glow_user', currentUser);
        }

        // INIT
        document.addEventListener('DOMContentLoaded', () => {
            switchUser(currentUser);
            // Go to current Monday to start view
            const today = new Date();
            const day = today.getDay();
            const diff = today.getDate() - day + (day == 0 ? -6 : 1); 
            viewDate.setDate(diff); // Set to Monday of current week
            
            // Si on charge la page et qu'on est aujourd'hui, on s√©lectionne aujourd'hui
            selectedDateStr = today.toISOString().split('T')[0];

            renderWeek();
        });

        // USER SWITCH
        function switchUser(u) {
            currentUser = u;
            document.body.className = u === 'siana' ? 'theme-siana' : 'theme-mel';
            
            // Button Styles
            const activeClass = u === 'siana' ? 'bg-pink-400 text-white shadow-md' : 'bg-violet-400 text-white shadow-md';
            const inactiveClass = 'text-gray-400 bg-transparent shadow-none';
            
            document.getElementById('btn-siana').className = `px-3 py-1.5 rounded-full text-xs font-bold transition-all ${u === 'siana' ? activeClass : inactiveClass}`;
            document.getElementById('btn-mel').className = `px-3 py-1.5 rounded-full text-xs font-bold transition-all ${u === 'mel' ? activeClass : inactiveClass}`;
            
            renderWorkout();
        }

        // WEEK LOGIC
        function changeWeek(direction) {
            viewDate.setDate(viewDate.getDate() + (direction * 7));
            renderWeek();
        }

        function getMonday(d) {
            d = new Date(d);
            const day = d.getDay();
            const diff = d.getDate() - day + (day == 0 ? -6 : 1); 
            return new Date(d.setDate(diff));
        }

        function renderWeek() {
            const monday = getMonday(viewDate);
            const sunday = new Date(monday);
            sunday.setDate(monday.getDate() + 6);

            // Update Header Title
            const opts = { day: 'numeric', month: 'short' };
            document.getElementById('week-display').innerText = `${monday.toLocaleDateString('fr-FR', opts)} - ${sunday.toLocaleDateString('fr-FR', opts)}`;

            const container = document.getElementById('days-container');
            container.innerHTML = '';

            // Generate 7 days
            for (let i = 0; i < 7; i++) {
                const tempDate = new Date(monday);
                tempDate.setDate(monday.getDate() + i);
                const iso = tempDate.toISOString().split('T')[0];
                const dayName = tempDate.toLocaleDateString('fr-FR', { weekday: 'short' }).replace('.', '');
                const dayNum = tempDate.getDate();

                const isActive = iso === selectedDateStr;
                const hasData = db[currentUser][iso] && db[currentUser][iso].length > 0;

                const div = document.createElement('div');
                div.className = `day-pill ${isActive ? 'day-active' : ''} cursor-pointer`;
                div.onclick = () => { selectedDateStr = iso; renderWeek(); renderWorkout(); };
                
                div.innerHTML = `
                    <span class="text-[10px] font-bold uppercase opacity-60 mb-1">${dayName}</span>
                    <span class="text-xl font-black">${dayNum}</span>
                    ${hasData ? `<div class="w-1.5 h-1.5 rounded-full mt-2" style="background:var(--primary-dark)"></div>` : ''}
                `;
                container.appendChild(div);
            }
            renderWorkout();
        }

        // WORKOUT LOGIC
        function renderWorkout() {
            const list = document.getElementById('workout-list');
            const data = db[currentUser][selectedDateStr] || [];
            
            // Title update
            const dateObj = new Date(selectedDateStr);
            document.getElementById('current-day-title').innerText = dateObj.toLocaleDateString('fr-FR', { weekday: 'long' });
            document.getElementById('current-full-date').innerText = dateObj.toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' });

            if (data.length === 0) {
                list.innerHTML = `
                    <div class="text-center py-12 opacity-40">
                        <div class="text-5xl mb-3 grayscale">ü¶Ñ</div>
                        <p class="text-sm font-bold text-pink-900">Repos ou pas encore planifi√©</p>
                    </div>`;
                return;
            }

            list.innerHTML = data.map((ex, index) => {
                let weightDisplay = '';
                if(ex.type === 'normal') {
                    weightDisplay = `<div class="text-xl font-black text-pink-600">${ex.w1} <span class="text-[10px] opacity-50 text-black">KG</span></div>`;
                } else {
                    const icon = ex.type === 'progressive' ? 'üìà' : 'üìâ';
                    weightDisplay = `
                        <div class="flex items-center gap-2">
                            <span class="text-lg font-bold text-gray-400">${ex.wStart}</span>
                            <span class="text-xs">‚ûî</span>
                            <span class="text-xl font-black text-pink-600">${ex.wEnd} <span class="text-[10px] opacity-50 text-black">KG</span></span>
                            <span class="text-xs">${icon}</span>
                        </div>
                    `;
                }

                return `
                <div class="card p-4 relative group anim-item" style="animation-delay: ${index * 0.05}s">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-bold text-lg text-pink-950 uppercase leading-tight w-3/4">${ex.name}</h4>
                        <button onclick="deleteEx(${index})" class="opacity-20 hover:opacity-100 text-red-500 font-bold px-2">‚úï</button>
                    </div>
                    <div class="flex justify-between items-end">
                        <div class="flex gap-3">
                            <div class="bg-pink-50 border border-pink-100 px-3 py-1 rounded-lg text-center">
                                <div class="text-[9px] uppercase font-bold text-gray-400">S√©ries</div>
                                <div class="font-bold text-pink-900">${ex.sets}</div>
                            </div>
                            <div class="bg-pink-50 border border-pink-100 px-3 py-1 rounded-lg text-center">
                                <div class="text-[9px] uppercase font-bold text-gray-400">Reps</div>
                                <div class="font-bold text-pink-900">${ex.reps}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            ${weightDisplay}
                        </div>
                    </div>
                </div>
                `;
            }).join('');
        }

        // ADD EXERCISE LOGIC
        function openModal() {
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('ex-name').focus();
        }
        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        function setType(t) {
            currentType = t;
            // Reset styles
            ['normal', 'progressive', 'degressive'].forEach(type => {
                const btn = document.getElementById(`btn-t-${type}`);
                if (type === t) {
                    btn.className = "py-2 rounded-xl text-[10px] font-bold border border-pink-200 bg-pink-50 text-pink-600 shadow-sm";
                } else {
                    btn.className = "py-2 rounded-xl text-[10px] font-bold border border-gray-100 text-gray-400";
                }
            });

            const single = document.getElementById('weight-single');
            const double = document.getElementById('weight-double');
            const hint = document.getElementById('hint-text');

            if (t === 'normal') {
                single.classList.remove('hidden');
                double.classList.add('hidden');
                hint.innerText = "Charge constante sur toutes les s√©ries";
            } else {
                single.classList.add('hidden');
                double.classList.remove('hidden');
                double.className = "grid grid-cols-[1fr_20px_1fr] gap-1 items-center"; // Force grid display
                hint.innerText = t === 'progressive' ? "Tu augmentes la charge √† chaque s√©rie" : "Tu diminues la charge (Drop set)";
            }
        }

        function saveExercise() {
            const name = document.getElementById('ex-name').value;
            if (!name) return alert("Il faut un nom !");

            const sets = document.getElementById('ex-sets').value || 4;
            const reps = document.getElementById('ex-reps').value || 10;
            
            let exData = {
                name, sets, reps, type: currentType
            };

            if (currentType === 'normal') {
                exData.w1 = document.getElementById('ex-w1').value || 0;
            } else {
                exData.wStart = document.getElementById('ex-w-start').value || 0;
                exData.wEnd = document.getElementById('ex-w-end').value || 0;
            }

            if (!db[currentUser][selectedDateStr]) db[currentUser][selectedDateStr] = [];
            db[currentUser][selectedDateStr].push(exData);
            
            saveDB();
            renderWorkout();
            renderWeek(); // To update the dot indicator
            closeModal();
            
            // Clear inputs
            document.getElementById('ex-name').value = '';
        }

        function deleteEx(index) {
            if(confirm('Supprimer cet exercice ?')) {
                db[currentUser][selectedDateStr].splice(index, 1);
                saveDB();
                renderWorkout();
                renderWeek();
            }
        }

        // COPY FEATURE
        function copyLastWeek() {
            // Calculate date - 7 days
            const curDate = new Date(selectedDateStr);
            const prevDate = new Date(curDate);
            prevDate.setDate(curDate.getDate() - 7);
            const prevIso = prevDate.toISOString().split('T')[0];

            const prevData = db[currentUser][prevIso];

            if (!prevData || prevData.length === 0) {
                alert("Rien trouv√© √† la date du " + prevDate.toLocaleDateString() + " üòï");
                return;
            }

            if (confirm(`Copier la s√©ance du ${prevDate.toLocaleDateString()} ?`)) {
                // Deep copy
                db[currentUser][selectedDateStr] = JSON.parse(JSON.stringify(prevData));
                saveDB();
                renderWorkout();
                renderWeek();
            }
        }

    </script>
</body>
</html>
