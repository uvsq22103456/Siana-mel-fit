<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FITNESS DUO</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-app: #FFF0F5; /* Fond rose tr√®s p√¢le */
            --card-bg: #FFFFFF;
            --text-main: #2D0A1E;
            --primary: #FF69B4; /* Hot Pink */
            --primary-soft: #FFB6C1;
            --input-bg: #F3F4F6;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-app);
            color: var(--text-main);
            height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .safe-top { padding-top: max(env(safe-area-inset-top), 20px); }
        .safe-bot { padding-bottom: max(env(safe-area-inset-bottom), 20px); }

        /* Styles identiques √† la capture */
        .user-toggle {
            background: #E5E7EB;
            border-radius: 999px;
            padding: 4px;
            display: inline-flex;
        }
        
        .main-card {
            background: var(--card-bg);
            border-radius: 30px;
            box-shadow: 0 10px 40px -10px rgba(255, 105, 180, 0.15);
            padding: 24px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 16px;
            position: relative;
            box-shadow: 0 4px 15px -5px rgba(0,0,0,0.05);
        }

        .day-sq {
            aspect-ratio: 1/1;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #9CA3AF;
            background: transparent;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .day-active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(255, 105, 180, 0.4);
        }

        .day-badge {
            background: var(--primary-soft);
            color: #831843;
            font-size: 8px;
            padding: 2px 4px;
            border-radius: 4px;
            margin-top: 2px;
            font-weight: 800;
            text-transform: uppercase;
            max-width: 100%;
            overflow: hidden;
            white-space: nowrap;
        }

        .custom-input {
            background: var(--input-bg);
            border-radius: 12px;
            border: none;
            padding: 8px 12px;
            font-weight: 700;
            color: var(--text-main);
            outline: none;
            width: 100%;
            text-align: center;
        }

        .nav-bar {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0,0,0,0.05);
        }
    </style>
</head>
<body onload="init()">

    <header class="safe-top px-6 pb-2 flex justify-between items-center">
        <div class="user-toggle">
            <button onclick="switchUser('siana')" id="btn-siana" class="px-5 py-2 rounded-full text-[10px] font-black uppercase transition-all bg-white shadow-sm text-pink-500">
                üë©üèΩ Siana
            </button>
            <button onclick="switchUser('mel')" id="btn-mel" class="px-5 py-2 rounded-full text-[10px] font-black uppercase transition-all text-gray-400">
                ü¶ã Mel
            </button>
        </div>
        <div class="text-[9px] font-black uppercase tracking-widest text-gray-400" id="top-date">MERCREDI 11 F√âVRIER</div>
    </header>

    <main class="flex-1 overflow-y-auto px-4 space-y-3 pt-2 pb-24">
        
        <div class="main-card h-[420px]"> <div class="flex justify-between items-center px-2 mb-2">
                <button onclick="changeWeek(-1)" class="text-gray-300 hover:text-pink-500 text-xl">‚Üê</button>
                <h2 id="month-label" class="text-xs font-black uppercase tracking-[0.2em] text-gray-800">F√âVRIER 2026</h2>
                <button onclick="changeWeek(1)" class="text-gray-300 hover:text-pink-500 text-xl">‚Üí</button>
            </div>

            <div id="week-grid" class="grid grid-cols-7 gap-1">
                </div>

            <div class="flex-1"></div>

            <div class="border-t border-gray-100 pt-4 flex items-center justify-between">
                <div>
                    <div class="text-[9px] font-black uppercase text-gray-400 mb-1">S√âANCE PR√âVUE LE <span id="sel-date-txt">11 F√âVR.</span></div>
                    <div id="plan-txt" class="text-2xl font-black text-gray-800">Legday</div>
                </div>
                <button onclick="openModal()" class="bg-pink-500 text-white px-6 py-3 rounded-xl text-[11px] font-black uppercase shadow-lg shadow-pink-200 active:scale-95 transition flex items-center gap-2">
                    <span>+</span> Planifier
                </button>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-3 h-36">
            
            <div class="stat-card flex flex-col justify-between">
                <div class="flex justify-between items-start">
                    <span class="text-[9px] font-black uppercase text-gray-400">Sommeil</span>
                    <span class="text-lg">üåô</span>
                </div>
                <div class="space-y-2 my-1">
                    <div class="flex justify-between items-center">
                        <span class="text-[8px] font-bold text-gray-300 uppercase">Coucher</span>
                        <input type="time" id="inp-sleep-start" onchange="saveStats()" class="bg-gray-100 rounded-lg px-2 py-1 text-[10px] font-bold w-16 text-center outline-none">
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-[8px] font-bold text-gray-300 uppercase">Lever</span>
                        <input type="time" id="inp-sleep-end" onchange="saveStats()" class="bg-gray-100 rounded-lg px-2 py-1 text-[10px] font-bold w-16 text-center outline-none">
                    </div>
                </div>
                <div class="text-center font-black text-lg text-indigo-900" id="sleep-total">--h--</div>
            </div>

            <div class="stat-card flex flex-col justify-between">
                <div class="flex justify-between items-start">
                    <span class="text-[9px] font-black uppercase text-gray-400">Activit√©</span>
                    <span class="text-lg">üë£</span>
                </div>
                <div class="flex-1 flex items-center justify-center">
                    <input type="number" id="inp-steps" placeholder="-" onchange="saveStats()" class="text-3xl font-black text-center w-full bg-transparent outline-none text-gray-800 placeholder-gray-200">
                </div>
                <div class="text-[8px] font-bold uppercase text-gray-300 text-center">Pas / Jour</div>
            </div>

        </div>

        <div class="stat-card flex items-center justify-between h-20">
            <div class="flex items-center gap-3">
                <div class="bg-blue-50 w-10 h-10 rounded-xl flex items-center justify-center text-blue-400 font-bold">üíß</div>
                <div>
                    <div class="text-[9px] font-black uppercase text-gray-400">Eau</div>
                    <div class="font-black text-xl text-blue-900"><span id="water-val">0</span> <span class="text-[9px] opacity-40 text-black">VERRES</span></div>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="updWater(-1)" class="w-8 h-8 rounded-full bg-gray-100 text-gray-400 font-bold">-</button>
                <button onclick="updWater(1)" class="w-8 h-8 rounded-full bg-blue-400 text-white shadow-md shadow-blue-200 font-bold">+</button>
            </div>
        </div>

        <div id="preview-list" class="space-y-2 pb-10"></div>

    </main>

    <nav class="nav-bar fixed bottom-0 w-full z-50 safe-bot">
        <div class="grid grid-cols-4 py-4">
            <button class="flex flex-col items-center gap-1">
                <div class="bg-pink-100 p-1 rounded-lg">
                    <span class="text-lg">üìÖ</span>
                </div>
                <span class="text-[8px] font-black uppercase text-pink-500">Dash</span>
            </button>
            <button onclick="alert('Page Sport')" class="flex flex-col items-center gap-1 opacity-40">
                <span class="text-lg">üí™</span>
                <span class="text-[8px] font-black uppercase">Sport</span>
            </button>
            <button onclick="alert('Page Nutri')" class="flex flex-col items-center gap-1 opacity-40">
                <span class="text-lg">ü•ë</span>
                <span class="text-[8px] font-black uppercase">Nutri</span>
            </button>
            <button onclick="alert('Page Body')" class="flex flex-col items-center gap-1 opacity-40">
                <span class="text-lg">üìè</span>
                <span class="text-[8px] font-black uppercase">Body</span>
            </button>
        </div>
    </nav>

    <div id="modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] hidden flex items-end sm:items-center justify-center">
        <div class="bg-white w-full sm:w-80 rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl">
            <div class="flex justify-between mb-4">
                <h3 class="font-black uppercase text-gray-800">Planifier</h3>
                <button onclick="closeModal()" class="font-bold text-gray-300">‚úï</button>
            </div>
            
            <input type="text" id="modal-input" placeholder="Titre (ex: Legday)" class="custom-input mb-4 bg-pink-50 text-pink-600 text-lg uppercase">
            
            <div class="grid grid-cols-3 gap-2 mb-4">
                <button onclick="setPlan('LEGDAY')" class="bg-gray-100 py-2 rounded-lg text-[9px] font-bold">LEGDAY</button>
                <button onclick="setPlan('UPPER')" class="bg-gray-100 py-2 rounded-lg text-[9px] font-bold">UPPER</button>
                <button onclick="setPlan('CARDIO')" class="bg-gray-100 py-2 rounded-lg text-[9px] font-bold">CARDIO</button>
                <button onclick="setPlan('FESSIERS')" class="bg-gray-100 py-2 rounded-lg text-[9px] font-bold">FESSIERS</button>
                <button onclick="setPlan('PILATES')" class="bg-gray-100 py-2 rounded-lg text-[9px] font-bold">PILATES</button>
                <button onclick="setPlan('REPOS')" class="bg-gray-100 py-2 rounded-lg text-[9px] font-bold">REPOS</button>
            </div>
            
            <button onclick="savePlan()" class="w-full bg-pink-500 text-white py-4 rounded-xl font-black uppercase text-xs shadow-lg">Valider</button>
        </div>
    </div>

    <script>
        let curUser = 'siana';
        let viewDate = new Date(); // Date de r√©f√©rence pour la grille
        let selDate = new Date().toISOString().split('T')[0]; // Date s√©lectionn√©e

        // Donn√©es
        let db = JSON.parse(localStorage.getItem('fitduo_final')) || {
            siana: { plan: {}, sleep: {}, steps: {}, water: {} },
            mel: { plan: {}, sleep: {}, steps: {}, water: {} }
        };

        function init() {
            // Caler viewDate sur le Lundi de la semaine en cours
            const day = viewDate.getDay();
            const diff = viewDate.getDate() - day + (day == 0 ? -6 : 1);
            viewDate.setDate(diff);
            
            selDate = new Date().toISOString().split('T')[0];
            
            render();
        }

        function save() {
            localStorage.setItem('fitduo_final', JSON.stringify(db));
            render();
        }

        function switchUser(u) {
            curUser = u;
            const btnS = document.getElementById('btn-siana');
            const btnM = document.getElementById('btn-mel');
            
            // Style Switch
            if(u === 'siana') {
                btnS.className = "px-5 py-2 rounded-full text-[10px] font-black uppercase transition-all bg-white shadow-sm text-pink-500";
                btnM.className = "px-5 py-2 rounded-full text-[10px] font-black uppercase transition-all text-gray-400";
                document.documentElement.style.setProperty('--primary', '#FF69B4');
                document.documentElement.style.setProperty('--bg-app', '#FFF0F5');
            } else {
                btnS.className = "px-5 py-2 rounded-full text-[10px] font-black uppercase transition-all text-gray-400";
                btnM.className = "px-5 py-2 rounded-full text-[10px] font-black uppercase transition-all bg-white shadow-sm text-violet-500";
                document.documentElement.style.setProperty('--primary', '#8B5CF6');
                document.documentElement.style.setProperty('--bg-app', '#F5F3FF');
            }
            render();
        }

        function changeWeek(dir) {
            viewDate.setDate(viewDate.getDate() + (dir * 7));
            render();
        }

        function render() {
            const ud = db[curUser];
            const dObj = new Date(selDate);

            // 1. Header Date
            document.getElementById('top-date').innerText = new Date().toLocaleDateString('fr-FR', {weekday:'long', day:'numeric', month:'long'});

            // 2. Grille Semaine
            const grid = document.getElementById('week-grid');
            grid.innerHTML = '';
            
            // Label Mois
            document.getElementById('month-label').innerText = viewDate.toLocaleDateString('fr-FR', {month:'long', year:'numeric'});

            // Boucle 7 jours
            let tempD = new Date(viewDate);
            for(let i=0; i<7; i++) {
                const iso = tempD.toISOString().split('T')[0];
                const dayNum = tempD.getDate();
                const dayName = tempD.toLocaleDateString('fr-FR', {weekday:'short'}).replace('.','');
                
                const isSel = iso === selDate;
                const plan = ud.plan[iso];

                // Case du jour
                let html = `
                <div onclick="selDate='${iso}'; render()" class="day-sq cursor-pointer ${isSel ? 'day-active' : ''}">
                    <span class="text-[9px] uppercase opacity-60 mb-1">${dayName}</span>
                    <span class="text-xl font-black leading-none">${dayNum}</span>
                    ${plan ? `<div class="day-badge" style="${isSel ? 'background:white; color:var(--primary)' : ''}">${plan.substring(0,4)}</div>` : '<div class="h-3"></div>'}
                </div>
                `;
                grid.innerHTML += html;
                tempD.setDate(tempD.getDate() + 1);
            }

            // 3. Footer Carte Principale
            document.getElementById('sel-date-txt').innerText = dObj.toLocaleDateString('fr-FR', {day:'numeric', month:'short'});
            document.getElementById('plan-txt').innerText = ud.plan[selDate] || "Rien pr√©vu";
            document.getElementById('plan-txt').style.opacity = ud.plan[selDate] ? '1' : '0.3';

            // 4. Stats
            const s = ud.sleep[selDate] || {};
            document.getElementById('inp-sleep-start').value = s.start || "";
            document.getElementById('inp-sleep-end').value = s.end || "";
            document.getElementById('sleep-total').innerText = s.total || "--h--";
            
            document.getElementById('inp-steps').value = ud.steps[selDate] || "";
            document.getElementById('water-val').innerText = ud.water[selDate] || 0;
        }

        // --- FONCTIONS ---
        function openModal() {
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('modal-input').value = db[curUser].plan[selDate] || "";
        }
        function closeModal() { document.getElementById('modal').classList.add('hidden'); }
        function setPlan(t) { document.getElementById('modal-input').value = t; }
        
        function savePlan() {
            const val = document.getElementById('modal-input').value;
            if(val) db[curUser].plan[selDate] = val;
            else delete db[curUser].plan[selDate];
            closeModal();
            save();
        }

        function saveStats() {
            // Sleep
            const st = document.getElementById('inp-sleep-start').value;
            const en = document.getElementById('inp-sleep-end').value;
            if(st && en) {
                let d1 = new Date("2000-01-01 "+st);
                let d2 = new Date("2000-01-01 "+en);
                if(d2 < d1) d2.setDate(d2.getDate()+1);
                const diff = (d2-d1)/1000/60/60;
                const h = Math.floor(diff);
                const m = Math.round((diff-h)*60);
                db[curUser].sleep[selDate] = { start: st, end: en, total: `${h}h${m<10?'0':''}${m}` };
            }
            // Steps
            db[curUser].steps[selDate] = document.getElementById('inp-steps').value;
            save();
        }

        function updWater(v) {
            let cur = db[curUser].water[selDate] || 0;
            cur += v; if(cur<0) cur=0;
            db[curUser].water[selDate] = cur;
            save();
        }
    </script>
</body>
</html>
